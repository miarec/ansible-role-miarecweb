---
# Install Python from system packages (based on ansible-python role)

# Define OS-specific Python packages
- name: Python | Define packages | RedHat
  set_fact:
    python3_packages:
      - python3
      - python3-devel
  when: ansible_facts['os_family'] == "RedHat"

- name: Python | Define packages | Debian
  set_fact:
    python3_packages:
      - python3
      - python3-dev
      - python3-venv
  when: ansible_facts['os_family'] == "Debian"

# Install EPEL for RedHat-based systems (except RHEL Enterprise itself)
- name: Python | Install EPEL repository | RedHat
  yum:
    name: epel-release
    state: present
  when:
    - ansible_facts['os_family'] == "RedHat"
    - ansible_facts['distribution'] != "RedHat"

# Install Python packages
- name: Python | Install Python3 packages
  package:
    name: "{{ item }}"
    state: present
  with_items: "{{ python3_packages }}"

# Detect installed Python version
- name: Python | Get installed Python3 version
  command: python3 --version
  register: python3_version_output
  changed_when: false

- name: Python | Set python_version fact
  set_fact:
    python_version: "{{ python3_version_output.stdout | regex_replace('^Python\\s+', '') }}"

- name: Python | Display installed Python version
  debug:
    msg: "Installed Python version: {{ python_version }}"
